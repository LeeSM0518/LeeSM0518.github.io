---
title: Stripe Docs
date: 2025-12-10 09:00:00 +0900
categories: stripe
tags:
  - stripe
  - docs
description: 
---

Stripe은 인터넷 비즈니스를 위한 **결제 인프라 플랫폼**입니다. 개발자가 복잡한 결제 시스템을 직접 구축하지 않고도 API 몇 줄로 신용카드 결제, 구독, 송금 등을 구현할 수 있게 해줍니다.

<br/>

**정기 결제 (Billing)**

구독을 생성하고 관리하고, 사용량을 추적하고, 인보이스를 발행하세요.

Stripe Billing을 사용하면 구독과 인보이스를 손쉽게 관리할 수 있습니다. 정기 결제를 자동화하고, 원하는 대로 가격 플랜을 설계하며, 체험 기간이나 갱신 같은 청구 주기를 유연하게 처리할 수 있습니다.

<br/>

**주요 기능**

- **가격 모델** : 정액제, 사용자 수 기반, 사용량 기반, 구간별, 변동형, 다중 통화 등 다양한 가격 모델을 만들 수 있습니다.
- **사용량 기반 과금** : 일간, 주간, 월간, 분기별, 연간 주기로 고객의 실제 사용량에 따라 과금할 수 있습니다.
- **자동화된 맞춤 인보이스** : 인보이스를 자동 생성하고 발송하며, 로고, 맞춤 필드, 템플릿, 항목 그룹화로 브랜딩할 수 있습니다.
- **스마트 재시도** : 결제 재시도 일정을 최적화하여 수금률을 높일 수 있습니다.
- **고객 포털** : 고객이 직접 구독을 관리할 수 있는 셀프서비스 포털을 제공합니다.

<br/>

## 1. Billing API 소개
---

구독(Subscription)은 인보이스(Invoice)와 결제 인텐트(PaymentIntent)를 자동으로 생성합니다. 구독은 다음과 같은 요소로 구성됩니다.

- **상품(Product)** : 비즈니스에서 판매하는 재화나 서비스를 나타냅니다.
- **가격(Price)** : 청구 금액과 주기를 정의합니다. 상품의 가격, 사용 통화, 구독의 경우 청구 간격을 포함합니다.
- **고객(Customer)** : 정기 결제에 사용되는 결제 수단(PaymentMethod)을 저장합니다.

![stripe1](/assets/img/stripe1.png)

```
고객 (Customer)
    └── 결제 수단 (PaymentMethod)
    └── 구독 (Subscription)
            └── 상품 (Product)
            │       └── 기능 (Feature) [ProductFeature로 연결]
            └── 가격 (Price)
            └── 인보이스 (Invoice)
                    └── 결제 인텐트 (PaymentIntent)
    └── 권한 (Entitlement) [구독 시 자동 생성]
```

<br/>

### 1.1. API 객체 정의
---


| 리소스                        | 정의                                                                                                                                                                     |
| -------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Customer (고객)**          | 구독을 구매하는 고객을 나타냅니다. <br>구독에 연결된 Customer 객체를 사용하여 정기 결제를 처리하고 추적하며, <br>고객이 구독 중인 상품을 관리합니다.                                                                           |
| **Entitlement (권한)**       | 고객이 구독한 서비스 상품에 포함된 기능에 대한 접근 권한을 나타냅니다.<br>고객이 상품을 정기 구매하는 구독을 생성하면, 해당 상품에 연결된 <br>각 기능에 대한 활성  권한이 자동으로 생성됩니다.<br>고객이 서비스에 접근할 때, 활성 권한을 통해 구독에 포함된 기능을 <br>활성화합니다. |
| **Feature (기능)**           | 고객이 서비스 상품을 구독할 때 접근할 수 있는 기능이나 능력을 나타냅니다.<br>ProductFeature를 생성하여 상품에 기능을 포함시킬 수 있습니다.                                                                                |
| **Invoice (청구서)**          | 고객이 지불해야 할 금액 명세서로, 초안부터 결제 완료 또는 확정까지 <br>결제 상태를 추적합니다.<br>구독이 자동으로 인보이스를 생성합니다.                                                                                      |
| **PaymentIntent (결제 의도)**  | 동적인 결제 플로우를 구축하는 방법입니다.<br>고객 결제 흐름의 생명주기를 추적하고, 규제 요건, Redar 사기 방지 규칙, <br>리디렉션 기반 결제 수단 등에 따라 추가 인증 단계를 트리거합니다.<br>인보이가 자동으로 PaymentIntent를 생성합니다.                   |
| **PaymentMethod (결제 수단)**  | 고객이 상품 결제에 사용하는 결제 수단입니다.<br>예를 들어 Customer 객체에 신용카드를 저장하고 해당 고객의 <br>정기 결제에 사용할 수 있습니다.<br>주로 Payment Instents나 Setup Instents API와 함께 사용합니다.                         |
| **Price (가격)**             | 상품의 단가, 통화, 청구 주기를 정의합니다.                                                                                                                                              |
| **Product (상품)**           | 비즈니스에서 판매하는 재화나 서비스입니다.<br>서비스 상품은 하나 이상의 기능을 포함할 수 있습니다.                                                                                                              |
| **ProductFeature (상품 기능)** | 단일 상품에 단일 기능이 포함되어 있음을 나타냅니다.<br>각 상품은 포함된 기능에 대해 ProductFeature와 연결되고,<br>각 기능은 해당 기능을 포함하는 각 상품에 대해 ProductFeature와 연결됩니다.                                           |
| **Subscription (구독)**      | 고객의 예정된 정기 상품 구매를 나타냅니다.<br>구독을 사용하여 결제를 수금하고 상품을 반복 배송하거나<br>지속적인 접근 권한을 제공합니다.                                                                                       |

<br/>

### 1.2. 상품, 기능, 권한이 함께 작동하는 예시
---

두 가지 등급의 정기 서비스를 설정한다고 가정해 보세요. 기본 기능을 제공하는 스탠다드 상품과 확장 기능이 추가된 어드밴스드 상품입니다.

<br/>

**설정 과정**

1. 두 개의 기능을 생성합니다: `basic_features` 와 `extended_features`
2. 두 개의 상품을 생성합니다: `standard_product` 와 `advanced_product`
3. 스탠다드 상품에는 `basic_feature` 를 `standard_product` 에 연결하는 ProductFeature 하나를 생성합니다.
4. 어드밴스드 상품에는 두 개의 ProductFeature를 생성합니다.
    1. `basic_features` 를 `advanced_product` 에 연결
    2. `extended_feature` 를 `advanced_product` 에 연결

<br/>

**고객 구독 시나리오**

첫 번째 고객 `first_customer` 가 스탠다드 상품을 구독합니다. 구독을 생성하면 Stripe가 자동으로 `first_customer` 와 `basic_features` 를 연결하는 권한(Entitlement)을 생성합니다.

두 번째 고객 `second_customer` 가 어드밴스드 상품을 구독합니다. 구독을 생성하면 Stripe가 자동으로 두 개의 권한을 생성합니다.
1. `second_customer` 와 `basic_features` 연결
2. `second_customer` 와 `extended_features` 연결

<br/>

**권한 확인 방법**

고객에게 어떤 기능을 제공할지 결정하려면 활성 권한을 조회하거나 Active Entitlement Summary 이벤트를 수신하면 됩니다. 구독, 상품, 기능을 일일이 조회할 필요가 없습니다.

<br/>

## 2. 구독 (Subscriptions)
---

Stripe Billing API로 구독을 생성하고 관리하세요.

<br/>

### 2.1. 구독의 작동 원리
---

정기 결제와 구독 생명주기를 관리하는 방법을 알아보세요.

Stripe는 구독 결제를 관리하는 데 유용한 다양한 기능을 제공합니다.
- 다양한 가격 모델 지원
- 구독 할인 관리
- 체험 기간 관리
- 구독 변경 시 비례 정산
- 고객 셀프 서비스 관리
- 결제 수금을 위한 인보이스 발행
- 자동 수익 복구
- 리포팅 및 분석

<br/>

### 2.2. 구독 생명주기
---

구독을 생성하고 관리하느 과정에는 Customers, Invoices, PaymentIntents 등 핵심 Stripe API 리소스가 사용됩니다.

권장하는 구독 플로우는 다음과 같습니다.

<br/>

#### 2.2.1. 구독 생성
---

대시보드나 API를 통해 새 구독을 생성합니다. 구독을 생성할 때마다 이벤트가 발생합니다. 웹훅 엔드포인트로 이 이벤트를 수신하고, 연동 시스템이 이를 적절히 처리하는지 확인하세요.

선택적으로 결제 없이 시작하는 체험판을 생성할 수 있습니다. 이 경우 상태는 `trialing` 이 됩니다. 체험 기간이 끝나면 구독이 `active` 로 전환되고 Stripe가 고객에게 과금합니다.

<br/>

**결제 동작 설정**

첫 결제 실패나 3DS(3D Secure, 카드 보안) 같은 복잡한 결제 플로우를 처리하려면 구독의 `payment_behavior` 를 default_incomplete로 설정하는 것을 권장합니다. 이렇게 하면 결제가 필요할 때 구독이 `incomplete` 상태로 생성되어, 이후에 결제 정보를 수집하고 확인하여 구독을 활성화할 수 있습니다.

- `payment_behavior` 설정값에 따른 동작
    - `allow_incomplete` : Stripe가 인보이스에 대해 즉시 결제를 시도합니다. 결제가 실패하면 구독 상태가 `incomplete` 로 변경됩니다.
    - `error_if_incomplete` : 결제가 실패하면 구독 생성 자체가 실패합니다.

대시보드에서 생성하는 구독은 결제 수단에 따라 적절한 결제 동작이 기본 설정됩니다.

<br/>

#### 2.2.2. 인보이스 처리
---

구독을 생성하면 Stripe가 자동으로 `open` 상태의 인보이스를 생성합니다. 고객은 약 23시간 내에 결제를 완료해야 합니다. 이 시간 동안 구독 상태는 `incomplete` 이고 인보이스는 `open` 을 유지합니다.

23시간 제한이 있는 이유는 보통 고객이 첫 결제를 온세션(고객이 결제 플로우에 직접 참여하여 결제 수단을 인증할 수 있는 상태) 상태에서 진행하기 때문입니다. 23시간이 지난 후 고객이 다시 방문하면 새 구독을 생성해야 합니다.

<br/>

#### 2.2.3. 고객 결제
---

고객이 인보이스를 결제하면 구독이 `active` 로, 인보이스가 `paid` 로 업데이트됩니다. 결제하지 않으면 구독은 `incomplete_expired` 로, 인보이스는 `void` 가 됩니다.

- 인보이스 결제 여부를 확인하는 방법
    - 웹훅 엔드포인트나 다른 이벤트 수신 방법을 설정하고 `invocie.paid` 이벤트를 수신합니다.
    - 구독 객체에서 `subscription.status=active` 인지 직접 확인합니다. 자동 과금이든 고객의 수동 결제든 인보이스가 결제되면 상태가 `active` 가 됩니다.

<br/>

#### 4. 상품 접근 권한 부여
---

고객을 위해 구독을 생성하면, 해당 상품에 연결된 각 기능에 대해 활성 권한(Entitlement)이 생성됩니다. 고객이 서비스에 접근할 때, 활성 권한을 확인하여 구독에 포함된 기능에 대한 접근을 허용하세요.

또는 웹훅 이벤트로 활성 구독을 추적하고 해당 활동을 기반으로 상품을 제공할 수도 있습니다.

<br/>

#### 2.2.5. 구독 업데이트
---

기존 구독을 취소하고 다시 만들 필요 없이 필요에 따라 수정할 수 있습니다. 주요 변경 사항으로는 구독 가격 업그레이드 또는 다운그레이드, 활성 구독의 결제 수금 일시 중지 등이 있습니다.

웹훅 엔드포인트로 구독 이벤트를 수신하여 구독 변경을 감지할 수 있습니다. 예를 들어 결제 실패 시 고객에게 이메일을 보내거나, 구독 취소 시 접근 권한을 회수할 수 있습니다.

Stripe Checkout 연동의 경우, 세션의 구독이 `incomplete` 상태이면 구독이나 인보이스를 업데이트할 수 없습니다. 세션 완료 후 업데이트하려면 `checkout.session.completed` 이벤트를 수신하세요. 세션의 구독을 취소하거나, 인보이스를 무효화하거나, 수금 불가로 표시하려면 세션을 만료시킬 수도 있습니다.

<br/>

#### 2.2.6. 첫 번째 인보이스 업데이트

collection_method가 `send_invoice` 인 경우 구독의 첫 인보이스를 업데이트할 수 있습니다. 인보이스 생성 후 1시간 이내에 금액, 항목, 설명, 메타데이터 등을 수정할 수 있습니다. 인보이스가 확정되어 고객에게 결제 요청이 전송된 후에는 수정할 수 없습니다.

`collection_method` 가 `charge_automatically` 인 경우 첫 인보이스는 즉시 확정되어 과금됩니다. 첫 인보이스는 확정 전에 수정할 수 없지만, 이후 갱신 인보이스는 수정할 수 있습니다.

구독 일정(subscription schedules)의 첫 인보이스는 수금 방식에 관계없이 항상 열린 상태이며 수정할 수 없습니다.

<br/>

#### 2.2.7. 미결제 구독 처리
---

미결제 인보이스가 있는 구독의 경우, 미결제 인보이스는 열린 상태로 유지되지만 추가 결제 시도는 중단됩니다. 구독은 매 청구 주기마다 인보이스를 계속 생성하며, 이 인보이스들은 `draft` 상태로 유지됩니다. 구독을 다시 활성화하려면:

1. 필요시 새 결제 정보를 수집합니다.
2. draft 인보이스에서 auto_advance 를 `true` 로 설정하여 자동 수금을 활성화합니다.
3. open 인보이스를 확정하고 결제합니다. 만기일 전에 가장 최근의 무효화되지 않은 인보이스를 결제하면 구독 상태가 `active` 로 업데이트됩니다.

수금 불가로 표시된 인보이스는 기본 구독을 `active` 상태로 유지합니다. Stripe는 구독 상태를 결정할 때 무효화된 인보이스를 무시하고 가장 최근의 무효화되지 않은 인보이스를 사용합니다.

미결제 구독의 상태는 대시보드의 결제 실패 설정에 따라 결정됩니다.

<br/>

#### 2.2.8. 구독 취소
---

구독은 언제든지 취소할 수 있으며, 청구 주기 말이나 지정된 청구 주기 후에 취소되도록 설정할 수도 있습니다.

기본적으로 구독을 취소하면 새 인보이스 생성이 비활성화되고 해당 구독의 모든 미결제 인보이스에 대한 자동 수금이 중단됩니다(`auto_advance=false`). 구독이 삭제되어 더 이상 구독이나 메타데이터를 업데이트할 수 없습니다. 고객이 재구독하려면 새 결제 정보를 수집하고 새 구독을 생성해야 합니다.

<br/>

### 2.3. 구독 상태
---


| **상태**               | **설명**                                                                                                                                                                                                                                |
| -------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `trialing`           | 현재 체험 기간중.<br>고객에게 상품을 안전하게 제공할 수 있습니다.<br>고객이 첫 결제를 하면 자동으로 `active` 로 전환됩니다.                                                                                                                                                        |
| `active`             | 구독이 정상 상태입니다.<br>`past_due` 구독의 경우 최근 인보이스를 결제하거나 수금 불가로 표시하면 <br>`active` 로 전환됩니다.<br>참고: `active` 가 해당 구독의 모든 미결제 인보이스가 결제되었음을 의미하지는 않습니다.                                                                                          |
| `incomplete`         | 고객이 23시간 내에 결제를 완료해야 구독이 활성화됩니다.<br>또는 결제에 고객 인증 같은 추가 조치가 필요합니다.<br>PaymentIntent 상태가 `processing` 인 보류 중인 결제가 있을 때도 <br>`incomplete` 가 될 수 있습니다.                                                                                    |
| `incomplete_expired` | 구독의 최초 결제가 실패했고 고객이 생성 후 23시간 내에 결제를 완료하지 못했습니다.<br>이 구독은 고객에게 과금하지 않습니다.<br>구독 활성화에 실패한 고객을 추적하기 위한 상태입니다.                                                                                                                           |
| `past_due`           | 가장 최근 확정된 인보이스의 결제가 실패했거나 시도되지 않았습니다.<br>구독은 계속 결제 인보이스를 생성합니다.<br>대시보드의 구독 설정에 따라 다음 상태가 결정됩니다.<br>모든 스마트 재시도 후에도 인보이스가 미결제면 구독을 `canceled` , `unpaid` 로 이동하거나<br>`past_due` 로 유지하도록 설정할 수 있습니다.<br>고객이 최근 인보이스를 결제하면 구독이 다시 활성화됩니다. |
| `canceled`           | 구독이 취소되었습니다.<br>취소 시 모든 미결제 인보이스의 자동 수금이 비활성화됩니다(`auto_advance=false`).<br>이는 업데이트할 수 없는 최종 상태입니다.                                                                                                                                    |
| `unpaid`             | 최근 인보이스가 결제되지 않았지만 구독은 유지됩니다.<br>최근 인보이스는 열린 상태로 유지되고 인보이스 생성은 계속되지만<br>결제 시도는 하지 않습니다.<br>`past_due` 동안 이미 결제 시도와 재시도가 이루어졌으므로 `unpaid` 상태일 때는<br>상품 접근을 차단하세요.<br>만기일 전에 최근 인보이스를 결제하면 구독이 `active` 로 전환됩니다.                        |
| `paused`             | 구독이 기본 결제 수단 없이 체험 기간을 종료했고<br>`trial_settings.end_behavior.missing_payument_method` 가 `pause` 로 설정되어 있습니다.<br>더 이상 인보이스가 생성되지 않습니다. 고객에게 기본 결제 수단을 연결한 후<br>구독을 재개할 수 있습니다.                                                          |

<br/>

### 2.4. 결제 상태
---

PaymentIntent는 모든 결제의 생명주기를 추적합니다. 구독에 결제가 필요할 때마다 Stripe가 인보이스와 PaymentIntent를 생성합니다. PaymentIntent ID는 인보이스에 첨부되며 Invoice와 Subscription 객체에서 접근할 수 있습니다.

PaymentIntent의 상태는 인보이스와 구독의 상태에 영향을 미칩니다. 결제 결과에 따른 상태 매핑은 다음과 같습니다.


| **결제 결과** | **PaymentIntent 상태**      | **인보이스 상태** | **구독 상태**    |
| --------- | ------------------------- | ----------- | ------------ |
| 성공        | `succeeded`               | `paid`      | `active`     |
| 카드 오류로 실패 | `requires_payment_method` | `open`      | `incomplete` |
| 인증 필요로 실패 | `requires_action`         | `open`      | `incomplete` |
- 참고: ACH Direct Debit 같은 비동기 결제 수단은 즉시 결제 수단과 다르게 구독 상태 전환을 처리합니다. 비동기 수단을 사용하면 구독이 다른 결제 유형과 관련된 `incomplete` 상태를 거치지 않고 생성 후 바로 `active` 상태로 전환됩니다. 비동기 결제가 나중에 실패하면 관련 인보이스가 무효화되지만 구독은 `active` 상태로 유지합니다. 이는 실패한 결제가 종종 `incomplete` 나 `past_due` 상태로 이어지는 즉시 결제 수단과 대조됩니다. 이 차이를 인식하고 구독 상태, 접근 제어, 결제 재시도 메커니즘을 관리하는 적절한 로직을 구현하세요.

<br/>

#### 2.4.1. 결제 성공
---

고객의 결제가 성공하면:
- PaymentIntent의 상태가 `succeeded` 로 변경됩니다.
- 구독 상태가 `active` 가 됩니다.
- 인보이스 상태가 `paid` 가 됩니다.
- Stripe가 설정된 웹훅 엔드포인트로 `invoice.paid` 이벤트를 전송합니다.

처리 기간이 긴 결제 수단의 경우 구독이 즉시 활성화됩니다. 이 경우 결제가 성공할 때까지 `active` 구독에 대한 PaymentIntent 상태가 `processing` 일 수 있습니다.

<br/>

#### 2.4.2. 결제 수단 필요
---

거절(decline) 같은 카드 오류로 결제가 실패하면:
- PaymentIntent 상태가 `requires_payment_method` 입니다.
- 구독 상태가 `incomplete` 입니다.
- 인보이스 상태가 `open` 입니다.

이 상황을 처리하려면:
- 고객에게 알립니다.
- 새 결제 정보를 수집하고 PaymentIntent를 확인합니다.
- 구독의 기본 결제 수단을 업데이트합니다.
- Stripe가 스마트 재시도를 사용하거나 사용자 정의 재시도 규칙에 따라 결제를 다시 시도합니다.
- `invoice.payment_failed` 이벤트를 사용하여 구독 결제 실패 이벤트와 재시도 업데이트를 모니터링합니다.

<br/>

#### 2.4.3. 추가 조치 필요
---

일부 결제 수단은 결제 프로세스를 완료하기 위해 3DS(3D Secure) 고객 인증이 필요합니다. 결제 수단에 인증이 필요한지는 Radar 규칙과 카드 발급 은행에 따라 다릅니다.

고객이 결제를 인증해야 해서 결제가 실패하면.
- PaymentIntent 상태가 `requires_action` 입니다.
- 구독 상태가 `incomplete` 입니다.
- 인보이스 상태가 `open` 입니다.

이 상황을 처리하려면:
- 웹훅 엔드포인트로 `invoice.payment_action_required` 이벤트 알림을 모니터링합니다. 인증이 필요함을 나타냅니다.
- 고객에게 인증이 필요하다고 알립니다.
- PaymentIntent의 클라이언트 시크릿을 가져와서 `stripe.ConfirmCardPayment` 호출에 전달합니다. 인증 모달이 표시되고, 결제를 시도한 후 모달이 닫히며 애플리케이션으로 컨텍스트가 반환됩니다.
- 이벤트 수신 대상에서 `invoice.paid` 이벤트를 모니터링하여 결제가 성공했는지 확인합니다. 사용자가 `confirmCardPayment()` 완료 전에 애플리케이션을 떠날 수 있으므로, 결제 성공 여부를 확인하면 상품을 올바르게 제공할 수 있습니다.

<br/>

### 2.5. 한눈에 보기
---

**구독 생명주기 요약**

```
구독 생성 → 인보이스 생성 (open) → 고객 결제
    ↓                                    ↓
체험 기간 (trialing)              결제 성공 → active
    ↓                                    ↓
23시간 내 미결제 → incomplete_expired   결제 실패 → incomplete
                                         ↓
                              재시도/인증 → active 또는 past_due
                                         ↓
                              최종 실패 → canceled/unpaid
```

<br/>

**주요 상태 전환**


| **이벤트**       | **이전 상태**                 | **이후 상태**             |
| ------------- | ------------------------- | --------------------- |
| 구독 생성 + 결제 대기 | -                         | `incomplete`          |
| 체험 기간 시작      | -                         | `trialing`            |
| 첫 결제 성공       | `incomplete` / `trialing` | `active`              |
| 23시간 내 미결제    | `incomplete`              | `incomplete_expired`  |
| 갱신 결제 실패      | `active`                  | `past_due`            |
| 재시도 모두 실패     | `past_due`                | `canceled` / `unpaid` |
| 구독 취소         | 모든 상태                     | `canceled`            |


<br/>

## Reference
---

<https://docs.stripe.com/revenue>